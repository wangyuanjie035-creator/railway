# 🚨 快速修复指南 - 404错误

## 问题诊断

从您的截图可以看出：
- **错误**: `API请求失败:404`
- **原因**: 草稿订单ID `gid://shopify/DraftOrder/1760585868362` 不存在
- **影响**: 客户无法查看订单详情

## 🔧 立即修复方案

### 方案1: 使用测试页面快速创建订单

1. **创建测试页面**：
   - 在Shopify后台创建新页面
   - **页面标题**: "测试创建订单"
   - **模板**: `page.test-create-order`
   - **URL**: `/pages/test-create-order`

2. **访问测试页面**：
   ```
   https://您的店铺.myshopify.com/pages/test-create-order
   ```

3. **创建测试订单**：
   - 填写测试信息
   - 点击"创建测试订单"
   - 系统会自动跳转到订单详情页

### 方案2: 重新提交询价

1. **访问上传页面**：
   ```
   https://您的店铺.myshopify.com/pages/model-uploader
   ```

2. **重新上传文件**：
   - 上传3D文件
   - 填写配置参数
   - 点击"立即询价"

3. **验证创建成功**：
   - 检查是否跳转到订单详情页
   - 确认订单ID正确显示

---

## 📋 部署步骤

### 1. 上传文件到Shopify

将以下文件上传到您的Shopify主题：

```
✅ templates/page.my-quotes.liquid (已更新)
✅ templates/page.test-create-order.liquid (新建)
✅ api/create-test-draft-order.js (新建)
```

### 2. 部署API到Vercel

```bash
# 提交代码到GitHub
git add .
git commit -m "修复404错误，添加测试功能"
git push

# Vercel会自动部署
```

### 3. 创建Shopify页面

在Shopify后台创建新页面：
- **页面标题**: "测试创建订单"
- **模板**: `page.test-create-order`
- **URL**: `/pages/test-create-order`

---

## 🔍 故障排除

### 问题1: 测试页面无法创建订单

**检查项目**：
1. Vercel API是否部署成功
2. 环境变量是否正确配置
3. 浏览器控制台是否有错误

**解决方法**：
```bash
# 检查API状态
curl https://shopify-13s4.vercel.app/api/create-test-draft-order
```

### 问题2: 环境变量问题

**检查Vercel设置**：
```
SHOP = 您的店铺.myshopify.com
ADMIN_TOKEN = shpat_xxxxxxxxxxxx
```

### 问题3: 权限问题

**确认Admin API权限**：
- `read_draft_orders`
- `write_draft_orders`
- `read_products`
- `write_products`

---

## 🎯 验证步骤

### 1. 测试API连接
访问：`https://shopify-13s4.vercel.app/api/test-shopify-connection`

**期望结果**：
```json
{
  "success": true,
  "message": "Shopify连接正常",
  "shop": {
    "name": "您的店铺名称"
  }
}
```

### 2. 测试创建订单
访问：`/pages/test-create-order`

**期望结果**：
- 页面正常加载
- 可以创建测试订单
- 自动跳转到订单详情页

### 3. 测试订单详情
访问：`/pages/my-quotes?id=<订单ID>`

**期望结果**：
- 显示订单详情
- 不出现404错误
- 所有信息正确显示

---

## ⚠️ 重要提醒

### 1. 产品变体ID配置
在`page.my-quotes.liquid`中确认产品变体ID：

```javascript
// 第417行附近
id: 您的产品变体ID, // ❌ 不能为0
```

### 2. API地址确认
确认所有文件中的API地址：

```javascript
const API_BASE = 'https://shopify-13s4.vercel.app/api';
```

### 3. CORS配置
确认API中的CORS头：

```javascript
res.setHeader('Access-Control-Allow-Origin', 'https://sain-pdc-test.myshopify.com');
```

---

## 📞 获取帮助

如果问题仍然存在，请提供：

1. **浏览器控制台截图**
2. **API响应内容**
3. **Vercel部署日志**
4. **详细错误信息**

---

## ✅ 修复检查清单

- [ ] 上传了更新的文件到Shopify
- [ ] 创建了测试页面
- [ ] 部署了API到Vercel
- [ ] 配置了环境变量
- [ ] 测试了API连接
- [ ] 创建了测试订单
- [ ] 验证了订单详情页
- [ ] 确认了产品变体ID
- [ ] 测试了完整流程

完成所有步骤后，404错误应该得到解决！🎉

---

## 🚀 下一步

修复404错误后，您可以：

1. **测试完整流程**：上传文件 → 询价 → 报价 → 下单
2. **配置生产环境**：设置正确的产品变体ID
3. **优化用户体验**：添加更多错误处理和用户提示
4. **监控系统**：定期检查API状态和订单创建情况

系统恢复正常后，您就拥有了一个完整的定制化询价系统！🎊
