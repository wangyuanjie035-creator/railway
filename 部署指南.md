# 🚀 部署指南

## 快速开始（5分钟部署）

### 步骤1：上传Shopify文件

将以下文件上传到您的Shopify主题：

```
✅ templates/page.my-quotes.liquid (新建)
✅ assets/model-uploader.js (更新)
✅ templates/page.admin-draft-orders.liquid (保留原有)
```

### 步骤2：创建Shopify页面

在Shopify后台创建新页面：
- **页面标题**: 我的询价单
- **模板**: page.my-quotes
- **URL**: `/pages/my-quotes`

### 步骤3：配置产品ID

在`page.my-quotes.liquid`第417行，修改虚拟产品ID：

```javascript
// 找到这行：
id: 0, // ❌ 需要修改

// 改为：
id: 您的产品变体ID, // ✅ 例如: 44738234089744
```

**如何获取产品变体ID：**
1. 在Shopify后台创建一个"询价产品"（价格设为¥0.00）
2. 进入产品编辑页面
3. 在浏览器控制台运行：
```javascript
fetch(window.location.href + '.js').then(r=>r.json()).then(d=>alert('变体ID: '+d.variants[0].id))
```

### 步骤4：部署到Vercel

```bash
# 1. 提交代码
git add .
git commit -m "实现草稿订单流程"
git push

# 2. Vercel自动部署（或手动）
vercel --prod
```

### 步骤5：配置环境变量

在Vercel项目设置中添加：
```
SHOP = 您的店铺.myshopify.com
ADMIN_TOKEN = shpat_xxxxxxxxxxxx
```

---

## 🎯 测试流程

### 客户端测试
1. 访问 `/pages/model-uploader`
2. 上传3D文件（如`.stp`文件）
3. 填写配置参数
4. 点击"立即询价"
5. 查看草稿订单详情页
6. 等待客服报价

### 管理端测试
1. 访问 `/pages/admin-draft-orders`
2. 登录（如果需要）
3. 查看订单列表
4. 点击"💰"报价按钮
5. 输入金额和备注
6. 提交报价

### 完成订单
1. 客户刷新详情页
2. 看到报价金额
3. 点击"立即下单"
4. 跳转到购物车
5. 点击"Checkout"完成支付

---

## ⚙️ 重要配置

### API基础地址
在以下文件中确认API地址正确：

**`assets/model-uploader.js` (第1139行):**
```javascript
const API_BASE = 'https://shopify-13s4.vercel.app/api';
```

**`templates/page.my-quotes.liquid` (第353行):**
```javascript
const API_BASE = 'https://shopify-13s4.vercel.app/api';
```

**`templates/page.admin-draft-orders.liquid` (第402行):**
```javascript
const API_BASE = 'https://shopify-13s4.vercel.app/api';
```

---

## 🛠️ 常见问题

### Q1: 点击"立即询价"后没有反应？
**A:** 检查浏览器控制台，确认API地址是否正确

### Q2: 草稿订单详情页显示"未找到订单"？
**A:** 确认URL中有`?id=xxx`参数，检查API是否返回数据

### Q3: "立即下单"按钮是灰色的？
**A:** 这是正常的，等待客服报价后按钮会变为可点击

### Q4: 添加到购物车失败？
**A:** 检查产品变体ID是否正确配置（不能为0）

### Q5: 后台看不到订单？
**A:** 确认Vercel环境变量配置正确，检查API日志

---

## 📞 获取帮助

如遇到问题，请提供：
1. 浏览器控制台截图
2. 详细错误信息
3. 操作步骤

---

## ✅ 部署检查清单

- [ ] Shopify文件已上传
- [ ] 创建了"我的询价单"页面
- [ ] 产品变体ID已配置
- [ ] Vercel已部署成功
- [ ] 环境变量已配置
- [ ] API地址已确认
- [ ] 客户端测试通过
- [ ] 管理端测试通过
- [ ] 完整流程测试通过

全部完成后，您的询价系统就可以投入使用了！🎉

