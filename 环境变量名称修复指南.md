# 🔧 环境变量名称修复指南

## 🎯 问题确认
您的Vercel项目中已设置了环境变量：
- ✅ `ADMIN_TOKEN` 
- ✅ `SHOP`

但API期望的变量名称是：
- ❌ `SHOPIFY_ACCESS_TOKEN`
- ❌ `SHOPIFY_STORE_DOMAIN`

## 🛠️ 解决方案

### 方案1：添加新的环境变量（推荐）
在Vercel项目设置中添加：
- **Name**: `SHOPIFY_ACCESS_TOKEN`
- **Value**: 与`ADMIN_TOKEN`相同的值
- **Environment**: All Environments

- **Name**: `SHOPIFY_STORE_DOMAIN`  
- **Value**: 与`SHOP`相同的值
- **Environment**: All Environments

### 方案2：使用现有变量（已完成代码修改）
我已经修改了所有API文件以支持您现有的变量名称：
- ✅ `api/submit-quote-real.js` - 支持`ADMIN_TOKEN`和`SHOP`
- ✅ `api/get-draft-orders.js` - 支持`ADMIN_TOKEN`和`SHOP`
- ✅ `api/diagnose-submit.js` - 支持`ADMIN_TOKEN`和`SHOP`

## 🚀 立即测试

### 步骤1：推送代码到GitHub
```bash
git add .
git commit -m "修复环境变量名称兼容性"
git push origin main
```

### 步骤2：等待Vercel自动部署
等待2-3分钟让Vercel重新部署

### 步骤3：测试诊断API
访问：`https://shopify-13s4.vercel.app/api/diagnose-submit`

**期望结果**：
```json
{
  "success": true,
  "message": "诊断信息",
  "diagnostics": {
    "environment": {
      "hasStoreDomain": true,
      "hasAccessToken": true,
      "storeDomain": "您的商店域名",
      "accessTokenLength": 32,
      "actualVariables": {
        "SHOPIFY_STORE_DOMAIN": false,
        "SHOP": true,
        "SHOPIFY_ACCESS_TOKEN": false,
        "ADMIN_TOKEN": true
      }
    },
    "testDraftOrderCreation": {
      "success": true,
      "status": 200
    }
  }
}
```

### 步骤4：测试询价提交
1. 访问model-uploader页面
2. 提交询价
3. 检查是否创建了真实的Shopify Draft Order

## 🎯 修复后的效果

### 客户端功能
- ✅ 询价提交创建真实的Shopify Draft Order
- ✅ 询价详情从真实数据获取
- ✅ 状态更新实时同步

### 管理端功能
- ✅ 能看到客户端提交的询价单
- ✅ 可以修改价格和状态
- ✅ 数据与客户端同步

## 📝 重要说明

- **兼容性**: API现在同时支持新旧环境变量名称
- **优先级**: 如果同时设置了新旧变量，优先使用新变量
- **安全性**: 环境变量值保持不变，只是添加了兼容性支持

---

**请推送代码到GitHub，等待Vercel重新部署后测试！**
