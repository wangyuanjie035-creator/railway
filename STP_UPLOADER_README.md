# STP文件上传和3D渲染功能说明

## 功能概述

本功能扩展了原有的3D模型上传器，新增了以下能力：

### ✅ 已实现功能

1. **STP文件支持**
   - 支持直接上传STP/STEP格式文件
   - 实时3D渲染显示
   - 使用Three.js进行高质量渲染

2. **ZIP文件处理**
   - 支持上传包含3D文件的ZIP压缩包
   - 自动解压并识别其中的STP/STL/OBJ等文件
   - 智能检测：如果ZIP中包含多个3D文件会提示错误
   - 如果ZIP中没有3D文件会显示相应错误信息

3. **增强的错误处理**
   - 文件格式验证
   - ZIP解压错误处理
   - 3D模型加载失败处理
   - 用户友好的错误提示

4. **改进的用户界面**
   - 加载指示器
   - 错误消息显示
   - 3D模型查看器
   - 支持的文件格式提示

## 支持的文件格式

### 直接支持
- `.stp` - STEP文件（新增）
- `.step` - STEP文件
- `.stl` - STL文件
- `.obj` - OBJ文件
- `.3mf` - 3MF文件
- `.iges` - IGES文件

### ZIP压缩包支持
- 包含上述任何格式文件的ZIP压缩包
- 支持嵌套文件夹结构
- 自动识别并提取第一个3D文件

## 使用方法

### 1. 上传STP文件
1. 点击"上传您的3D模型"按钮
2. 选择STP或STEP文件
3. 系统会自动加载并渲染3D模型
4. 可以旋转、缩放查看模型

### 2. 上传ZIP文件
1. 点击"上传您的3D模型"按钮
2. 选择包含3D文件的ZIP压缩包
3. 系统会自动解压并识别3D文件
4. 如果找到STP文件，会进行3D渲染
5. 如果没有找到支持的3D文件，会显示错误信息

### 3. 拖拽上传
- 直接将文件拖拽到上传区域
- 支持单个文件或ZIP压缩包

## 技术实现

### 前端技术栈
- **JSZip**: ZIP文件解压
- **Three.js**: STP文件3D渲染
- **Model Viewer**: 其他格式3D渲染
- **原生JavaScript**: 文件处理和UI交互

### 核心功能模块

1. **文件处理模块**
   ```javascript
   - processFile(): 文件类型识别和处理
   - extractStpFromZip(): ZIP解压和文件提取
   - isSupported3DFile(): 文件格式验证
   ```

2. **3D渲染模块**
   ```javascript
   - load3DModel(): 3D模型加载入口
   - renderStpWithThreeJS(): STP文件Three.js渲染
   - renderWithModelViewer(): 其他格式Model Viewer渲染
   ```

3. **错误处理模块**
   ```javascript
   - showError(): 错误消息显示
   - hideError(): 错误消息隐藏
   - showLoading(): 加载状态显示
   ```

## 错误处理

### 常见错误及解决方案

1. **"不支持的文件格式"**
   - 确保上传的是支持的3D文件格式
   - 检查文件扩展名是否正确

2. **"ZIP文件中没有找到支持的3D文件"**
   - 确保ZIP中包含STP、STL、OBJ等支持的格式
   - 检查文件是否在子文件夹中

3. **"ZIP文件中找到多个3D文件"**
   - 确保ZIP中只包含一个3D文件
   - 删除多余的3D文件后重新压缩

4. **"3D模型加载失败"**
   - 检查文件是否损坏
   - 尝试使用其他3D建模软件重新保存文件

## 性能优化

### 文件大小限制
- 建议单个文件不超过50MB
- ZIP文件建议不超过100MB
- 大型文件可能影响加载速度

### 浏览器兼容性
- 现代浏览器（Chrome 60+, Firefox 55+, Safari 12+）
- 需要WebGL支持
- 移动设备性能可能受限

## 未来扩展

### 计划功能
1. **服务器端STP解析**
   - 更准确的STP文件解析
   - 支持复杂几何体

2. **文件预览优化**
   - 缩略图生成
   - 多角度预览

3. **批量处理**
   - 多文件同时上传
   - 批量价格计算

## 故障排除

### 如果3D模型不显示
1. 检查浏览器控制台是否有错误信息
2. 确认文件格式是否正确
3. 尝试刷新页面重新上传

### 如果ZIP解压失败
1. 确认ZIP文件没有密码保护
2. 检查ZIP文件是否损坏
3. 尝试重新压缩文件

### 性能问题
1. 关闭其他占用内存的应用程序
2. 使用更现代的浏览器
3. 减少文件大小

## 联系支持

如果遇到问题，请提供以下信息：
- 浏览器版本
- 文件格式和大小
- 错误截图或控制台信息
- 操作步骤描述
